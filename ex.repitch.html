<!DOCTYPE html>
<html>
<head>
<meta charset="utf8">
<title>Web Audio: play a sound</title>
<style>
  button {
    color: white;
    padding: 10px 20px;
    font-size: large;
    margin-bottom: 10px;
    background: #96729E;
    cursor: pointer;
    border-radius: 4px;
    border: 1px solid rgba(0, 0, 0, .15);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.25), 0 1px 2px rgba(0, 0, 0, 0.25);
  }
  button:hover, [role="button"]:hover {
    filter: brightness(1.2);
    color: white;
  }
</style>
</head>
<body>
<button onclick="play()">â–¶ play</button>
<button onclick="stop()">STOP!!!!</button>
<p><input type="checkbox" id="repitch" /> Repitch</p>

<script>

const audioContext = new AudioContext();
let sample;

const C3 = 130.81;
const c3d150 = 150 / C3; // 1.1467013225;

function play() {
  fetch('Roland-SC-88-Cello-C3-glued-01.wav')
    .then(response => response.arrayBuffer())
    .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
    .then(audioBuffer => {
      sample = audioContext.createBufferSource();
      sample.buffer = audioBuffer;
      sample.loop = true;
      sample.playbackRate.value = repitch.checked ? c3d150 : 1;
      sample.connect(audioContext.destination);
      sample.start();
    })
    .catch(e => console.log('uff'));
}

function stop() {
  sample.stop();
}

</script>
</body>
</html>
